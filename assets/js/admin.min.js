!function(e){var a={init:function(){e("a#wegal-add-image").on("click",this.imageUpload),e("#wegal-image-wrap").on("click","a.image-delete",this.removeImage),e("#wegal-image-wrap").on("click","a.image-edit",this.showPopup),e(".wegal-popup-close").on("click",this.closePopup),e("input#wegal-image-update").on("click",this.updateImage),this.makeSortable()},imageUpload:function(a){a.preventDefault();var t,i=e(this);return t?void t.open():(t=wp.media({title:i.data("uploader-title"),button:{text:i.data("uploader-button")},library:{type:"image"},multiple:!0}),t.on("select",function(){var a=t.state().get("selection").toJSON(),i='<div class="thumb"><img src="<%= url %>" alt=""><a href="#" class="image-delete">&times</a><a href="#" class="image-edit dashicons dashicons-edit" data-attachment_id="<%= id %>">&nbsp;</a><input type="hidden" name="_wegal_image[]" value="<%= id %>"></div>',n="";_.each(a,function(e){var a="";a="undefined"!=typeof e.sizes.thumbnail?e.sizes.thumbnail.url:e.url,n+=_.template(i,{url:a,id:e.id})}),e("#wegal-image-wrap").append(n)}),void t.open())},removeImage:function(a){a.preventDefault(),e(this).closest(".thumb").remove()},makeSortable:function(){e("#wegal-image-wrap").sortable({items:".thumb"})},closePopup:function(e){e.preventDefault(),a.hidePopup()},hidePopup:function(){e("#wegal-popup-box").hide(),e("#wegal-popup-overlay").hide(),e("#wegal-ajax-content").html('<span class="spinner"></span>')},showPopup:function(a){a.preventDefault();var t=e(this),i=t.data("attachment_id"),n=new wp.media.model.Attachment({id:i});e("#wegal-popup-overlay").show(),e("#wegal-popup-box").show(),n.fetch({success:function(a,t){var i=_.template(e("#wegal-tmpl-image-editor").html(),{image:t});e("#wegal-ajax-content").html(i)},error:function(e,a){}})},updateImage:function(t){t.preventDefault();var i={id:e("#wegal-input-att-id").val(),title:e("#wegal-input-title").val(),caption:e("#wegal-input-caption").val(),alt:e("#wegal-input-alt").val(),description:e("#wegal-input-description").val(),_wpnonce:wegalAdmin.nonce,action:"wegal_save_image_details"};e.post(wegalAdmin.ajaxurl,i),a.hidePopup()}};e(function(){a.init()})}(jQuery);